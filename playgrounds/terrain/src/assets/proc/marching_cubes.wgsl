#define_import_path proc:marching_cubes;

// ============================================================================
// Marching Cubes lookup tables + helpers (WGSL version)
// ============================================================================

// Edge → (corner_a, corner_b)
const EDGE_VERTEX_INDICES : array<vec2<u32>, 12> = array<vec2<u32>, 12>(
    vec2<u32>(0u, 1u),
    vec2<u32>(1u, 2u),
    vec2<u32>(2u, 3u),
    vec2<u32>(3u, 0u),
    vec2<u32>(4u, 5u),
    vec2<u32>(5u, 6u),
    vec2<u32>(6u, 7u),
    vec2<u32>(7u, 4u),
    vec2<u32>(0u, 4u),
    vec2<u32>(1u, 5u),
    vec2<u32>(2u, 6u),
    vec2<u32>(3u, 7u)
);

// Canonical cube corner positions
const CUBE_CORNERS : array<vec3<f32>, 8> = array<vec3<f32>, 8>(
    vec3<f32>(0.0, 0.0, 0.0), // 0
    vec3<f32>(1.0, 0.0, 0.0), // 1
    vec3<f32>(1.0, 0.0, 1.0), // 2
    vec3<f32>(0.0, 0.0, 1.0), // 3
    vec3<f32>(0.0, 1.0, 0.0), // 4
    vec3<f32>(1.0, 1.0, 0.0), // 5
    vec3<f32>(1.0, 1.0, 1.0), // 6
    vec3<f32>(0.0, 1.0, 1.0)  // 7
);

// ============================================================================
// Compute cube index (bitmask)
// corners[i] < 0 → inside
// ============================================================================
fn mc_get_cube_index(c0: f32, c1: f32, c2: f32, c3: f32,
                     c4: f32, c5: f32, c6: f32, c7: f32) -> u32 {

    var idx : u32 = 0u;

    if (c0 < 0.0) { idx = idx | 1u; }
    if (c1 < 0.0) { idx = idx | 2u; }
    if (c2 < 0.0) { idx = idx | 4u; }
    if (c3 < 0.0) { idx = idx | 8u; }
    if (c4 < 0.0) { idx = idx | 16u; }
    if (c5 < 0.0) { idx = idx | 32u; }
    if (c6 < 0.0) { idx = idx | 64u; }
    if (c7 < 0.0) { idx = idx | 128u; }

    return idx;
}

// ============================================================================
// Linear interpolation along an edge
// edge        = edge index 0..11
// cube_origin = world-space origin of this cube
// cube_size   = size of cube in world units
// corner_vals = SDF values per corner
// ============================================================================
fn mc_interpolate_vertex(
    edge        : u32,
    cube_origin : vec3<f32>,
    cube_size   : f32,
    corner_vals : array<f32, 8>
) -> vec3<f32> {

    let idx = EDGE_VERTEX_INDICES[edge];
    let a = idx.x;
    let b = idx.y;

    let v1 = CUBE_CORNERS[a];
    let v2 = CUBE_CORNERS[b];

    let val1 = corner_vals[a];
    let val2 = corner_vals[b];

    // If close to equal, use midpoint
    if (abs(val1 - val2) < 1e-6) {
        return cube_origin + (v1 + v2) * 0.5 * cube_size;
    }

    // Linear interpolation t = -v1 / (v2 - v1)
    let t_raw = (-val1) / (val2 - val1);
    let t     = clamp(t_raw, 0.0, 1.0);

    let local = v1 + (v2 - v1) * t;
    return cube_origin + local * cube_size;
}

// ============================================================================
// TRIANGULATION TABLE
// 256 entries, each a list of edge indices making triangles (terminated by -1)
// We use 15 columns just like your Rust version.
// ============================================================================
const TRIANGULATIONS : array<array<i32, 15>, 256> = array<array<i32, 15>, 256>(
    // --- ENTRY 0 ---
    array<i32, 15>(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 1 ---
    array<i32, 15>(0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 2 ---
    array<i32, 15>(0, 1, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 3 ---
    array<i32, 15>(1, 8, 3, 9, 8, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 4 ---
    array<i32, 15>(1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 5 ---
    array<i32, 15>(0, 8, 3, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 6 ---
    array<i32, 15>(9, 2, 10, 0, 2, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 7 ---
    array<i32, 15>(2, 8, 3, 2, 10, 8, 10, 9, 8, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 8 ---
    array<i32, 15>(3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 9 ---
    array<i32, 15>(0, 11, 2, 8, 11, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 10 ---
    array<i32, 15>(1, 9, 0, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 11 ---
    array<i32, 15>(1, 11, 2, 1, 9, 11, 9, 8, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 12 ---
    array<i32, 15>(3, 10, 1, 11, 10, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 13 ---
    array<i32, 15>(0, 10, 1, 0, 8, 10, 8, 11, 10, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 14 ---
    array<i32, 15>(3, 9, 0, 3, 11, 9, 11, 10, 9, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 15 ---
    array<i32, 15>(9, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 16 ---
    array<i32, 15>(4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 17 ---
    array<i32, 15>(4, 3, 0, 7, 3, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 18 ---
    array<i32, 15>(0, 1, 9, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 19 ---
    array<i32, 15>(4, 1, 9, 4, 7, 1, 7, 3, 1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 20 ---
    array<i32, 15>(1, 2, 10, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 21 ---
    array<i32, 15>(3, 4, 7, 3, 0, 4, 1, 2, 10, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 22 ---
    array<i32, 15>(9, 2, 10, 9, 0, 2, 8, 4, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 23 ---
    array<i32, 15>(2, 10, 9, 2, 9, 7, 2, 7, 3, 7, 9, 4, -1, -1, -1),
    // --- ENTRY 24 ---
    array<i32, 15>(8, 4, 7, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 25 ---
    array<i32, 15>(11, 4, 7, 11, 2, 4, 2, 0, 4, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 26 ---
    array<i32, 15>(9, 0, 1, 8, 4, 7, 2, 3, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 27 ---
    array<i32, 15>(4, 7, 11, 9, 4, 11, 9, 11, 2, 9, 2, 1, -1, -1, -1),
    // --- ENTRY 28 ---
    array<i32, 15>(3, 10, 1, 3, 11, 10, 7, 8, 4, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 29 ---
    array<i32, 15>(1, 11, 10, 1, 4, 11, 1, 0, 4, 7, 11, 4, -1, -1, -1),
    // --- ENTRY 30 ---
    array<i32, 15>(4, 7, 8, 9, 0, 11, 9, 11, 10, 11, 0, 3, -1, -1, -1),
    // --- ENTRY 31 ---
    array<i32, 15>(4, 7, 11, 4, 11, 9, 9, 11, 10, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 32 ---
    array<i32, 15>(9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 33 ---
    array<i32, 15>(9, 5, 4, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 34 ---
    array<i32, 15>(0, 5, 4, 1, 5, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 35 ---
    array<i32, 15>(8, 5, 4, 8, 3, 5, 3, 1, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 36 ---
    array<i32, 15>(1, 2, 10, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 37 ---
    array<i32, 15>(3, 0, 8, 1, 2, 10, 4, 9, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 38 ---
    array<i32, 15>(5, 2, 10, 5, 4, 2, 4, 0, 2, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 39 ---
    array<i32, 15>(2, 10, 5, 3, 2, 5, 3, 5, 4, 3, 4, 8, -1, -1, -1),
    // --- ENTRY 40 ---
    array<i32, 15>(9, 5, 4, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 41 ---
    array<i32, 15>(0, 11, 2, 0, 8, 11, 4, 9, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 42 ---
    array<i32, 15>(0, 5, 4, 0, 1, 5, 2, 3, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 43 ---
    array<i32, 15>(2, 1, 5, 2, 5, 8, 2, 8, 11, 4, 8, 5, -1, -1, -1),
    // --- ENTRY 44 ---
    array<i32, 15>(10, 3, 11, 10, 1, 3, 9, 5, 4, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 45 ---
    array<i32, 15>(4, 9, 5, 0, 8, 1, 8, 10, 1, 8, 11, 10, -1, -1, -1),
    // --- ENTRY 46 ---
    array<i32, 15>(5, 4, 0, 5, 0, 11, 5, 11, 10, 11, 0, 3, -1, -1, -1),
    // --- ENTRY 47 ---
    array<i32, 15>(5, 4, 8, 5, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 48 ---
    array<i32, 15>(9, 7, 8, 5, 7, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 49 ---
    array<i32, 15>(9, 3, 0, 9, 5, 3, 5, 7, 3, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 50 ---
    array<i32, 15>(0, 7, 8, 0, 1, 7, 1, 5, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 51 ---
    array<i32, 15>(1, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 52 ---
    array<i32, 15>(9, 7, 8, 9, 5, 7, 10, 1, 2, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 53 ---
    array<i32, 15>(10, 1, 2, 9, 5, 0, 5, 3, 0, 5, 7, 3, -1, -1, -1),
    // --- ENTRY 54 ---
    array<i32, 15>(8, 0, 2, 8, 2, 5, 8, 5, 7, 10, 5, 2, -1, -1, -1),
    // --- ENTRY 55 ---
    array<i32, 15>(2, 10, 5, 2, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 56 ---
    array<i32, 15>(7, 9, 5, 7, 8, 9, 3, 11, 2, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 57 ---
    array<i32, 15>(9, 5, 7, 9, 7, 2, 9, 2, 0, 2, 7, 11, -1, -1, -1),
    // --- ENTRY 58 ---
    array<i32, 15>(2, 3, 11, 0, 1, 8, 1, 7, 8, 1, 5, 7, -1, -1, -1),
    // --- ENTRY 59 ---
    array<i32, 15>(11, 2, 1, 11, 1, 7, 7, 1, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 60 ---
    array<i32, 15>(9, 5, 8, 8, 5, 7, 10, 1, 3, 10, 3, 11, -1, -1, -1),
    // --- ENTRY 61 ---
    array<i32, 15>(5, 7, 0, 5, 0, 9, 7, 11, 0, 1, 0, 10, 11, 10, 0),
    // --- ENTRY 62 ---
    array<i32, 15>(11, 10, 0, 11, 0, 3, 10, 5, 0, 8, 0, 7, 5, 7, 0),
    // --- ENTRY 63 ---
    array<i32, 15>(11, 10, 5, 7, 11, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 64 ---
    array<i32, 15>(10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 65 ---
    array<i32, 15>(0, 8, 3, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 66 ---
    array<i32, 15>(9, 0, 1, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 67 ---
    array<i32, 15>(1, 8, 3, 1, 9, 8, 5, 10, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 68 ---
    array<i32, 15>(1, 6, 5, 2, 6, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 69 ---
    array<i32, 15>(1, 6, 5, 1, 2, 6, 3, 0, 8, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 70 ---
    array<i32, 15>(9, 6, 5, 9, 0, 6, 0, 2, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 71 ---
    array<i32, 15>(5, 9, 8, 5, 8, 2, 5, 2, 6, 3, 2, 8, -1, -1, -1),
    // --- ENTRY 72 ---
    array<i32, 15>(2, 3, 11, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 73 ---
    array<i32, 15>(11, 0, 8, 11, 2, 0, 10, 6, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 74 ---
    array<i32, 15>(0, 1, 9, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 75 ---
    array<i32, 15>(5, 10, 6, 1, 9, 2, 9, 11, 2, 9, 8, 11, -1, -1, -1),
    // --- ENTRY 76 ---
    array<i32, 15>(6, 3, 11, 6, 5, 3, 5, 1, 3, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 77 ---
    array<i32, 15>(0, 8, 11, 0, 11, 5, 0, 5, 1, 5, 11, 6, -1, -1, -1),
    // --- ENTRY 78 ---
    array<i32, 15>(3, 11, 6, 0, 3, 6, 0, 6, 5, 0, 5, 9, -1, -1, -1),
    // --- ENTRY 79 ---
    array<i32, 15>(6, 5, 9, 6, 9, 11, 11, 9, 8, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 80 ---
    array<i32, 15>(5, 10, 6, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 81 ---
    array<i32, 15>(4, 3, 0, 4, 7, 3, 6, 5, 10, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 82 ---
    array<i32, 15>(1, 9, 0, 5, 10, 6, 8, 4, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 83 ---
    array<i32, 15>(10, 6, 5, 1, 9, 7, 1, 7, 3, 7, 9, 4, -1, -1, -1),
    // --- ENTRY 84 ---
    array<i32, 15>(6, 1, 2, 6, 5, 1, 4, 7, 8, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 85 ---
    array<i32, 15>(1, 2, 5, 5, 2, 6, 3, 0, 4, 3, 4, 7, -1, -1, -1),
    // --- ENTRY 86 ---
    array<i32, 15>(8, 4, 7, 9, 0, 5, 0, 6, 5, 0, 2, 6, -1, -1, -1),
    // --- ENTRY 87 ---
    array<i32, 15>(7, 3, 9, 7, 9, 4, 3, 2, 9, 5, 9, 6, 2, 6, 9),
    // --- ENTRY 88 ---
    array<i32, 15>(3, 11, 2, 7, 8, 4, 10, 6, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 89 ---
    array<i32, 15>(5, 10, 6, 4, 7, 2, 4, 2, 0, 2, 7, 11, -1, -1, -1),
    // --- ENTRY 90 ---
    array<i32, 15>(0, 1, 9, 4, 7, 8, 2, 3, 11, 5, 10, 6, -1, -1, -1),
    // --- ENTRY 91 ---
    array<i32, 15>(9, 2, 1, 9, 11, 2, 9, 4, 11, 7, 11, 4, 5, 10, 6),
    // --- ENTRY 92 ---
    array<i32, 15>(8, 4, 7, 3, 11, 5, 3, 5, 1, 5, 11, 6, -1, -1, -1),
    // --- ENTRY 93 ---
    array<i32, 15>(5, 1, 11, 5, 11, 6, 1, 0, 11, 7, 11, 4, 0, 4, 11),
    // --- ENTRY 94 ---
    array<i32, 15>(0, 5, 9, 0, 6, 5, 0, 3, 6, 11, 6, 3, 8, 4, 7),
    // --- ENTRY 95 ---
    array<i32, 15>(6, 5, 9, 6, 9, 11, 4, 7, 9, 7, 11, 9, -1, -1, -1),
    // --- ENTRY 96 ---
    array<i32, 15>(10, 4, 9, 6, 4, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 97 ---
    array<i32, 15>(4, 10, 6, 4, 9, 10, 0, 8, 3, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 98 ---
    array<i32, 15>(10, 0, 1, 10, 6, 0, 6, 4, 0, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 99 ---
    array<i32, 15>(8, 3, 1, 8, 1, 6, 8, 6, 4, 6, 1, 10, -1, -1, -1),
    // --- ENTRY 100 ---
    array<i32, 15>(1, 4, 9, 1, 2, 4, 2, 6, 4, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 101 ---
    array<i32, 15>(3, 0, 8, 1, 2, 9, 2, 4, 9, 2, 6, 4, -1, -1, -1),
    // --- ENTRY 102 ---
    array<i32, 15>(0, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 103 ---
    array<i32, 15>(8, 3, 2, 8, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 104 ---
    array<i32, 15>(10, 4, 9, 10, 6, 4, 11, 2, 3, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 105 ---
    array<i32, 15>(0, 8, 2, 2, 8, 11, 4, 9, 10, 4, 10, 6, -1, -1, -1),
    // --- ENTRY 106 ---
    array<i32, 15>(3, 11, 2, 0, 1, 6, 0, 6, 4, 6, 1, 10, -1, -1, -1),
    // --- ENTRY 107 ---
    array<i32, 15>(6, 4, 1, 6, 1, 10, 4, 8, 1, 2, 1, 11, 8, 11, 1),
    // --- ENTRY 108 ---
    array<i32, 15>(9, 6, 4, 9, 3, 6, 9, 1, 3, 11, 6, 3, -1, -1, -1),
    // --- ENTRY 109 ---
    array<i32, 15>(8, 11, 1, 8, 1, 0, 11, 6, 1, 9, 1, 4, 6, 4, 1),
    // --- ENTRY 110 ---
    array<i32, 15>(3, 11, 6, 3, 6, 0, 0, 6, 4, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 111 ---
    array<i32, 15>(6, 4, 8, 11, 6, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 112 ---
    array<i32, 15>(7, 10, 6, 7, 8, 10, 8, 9, 10, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 113 ---
    array<i32, 15>(0, 7, 3, 0, 10, 7, 0, 9, 10, 6, 7, 10, -1, -1, -1),
    // --- ENTRY 114 ---
    array<i32, 15>(10, 6, 7, 1, 10, 7, 1, 7, 8, 1, 8, 0, -1, -1, -1),
    // --- ENTRY 115 ---
    array<i32, 15>(10, 6, 7, 10, 7, 1, 1, 7, 3, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 116 ---
    array<i32, 15>(1, 2, 6, 1, 6, 8, 1, 8, 9, 8, 6, 7, -1, -1, -1),
    // --- ENTRY 117 ---
    array<i32, 15>(2, 6, 9, 2, 9, 1, 6, 7, 9, 0, 9, 3, 7, 3, 9),
    // --- ENTRY 118 ---
    array<i32, 15>(7, 8, 0, 7, 0, 6, 6, 0, 2, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 119 ---
    array<i32, 15>(7, 3, 2, 6, 7, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 120 ---
    array<i32, 15>(2, 3, 11, 10, 6, 8, 10, 8, 9, 8, 6, 7, -1, -1, -1),
    // --- ENTRY 121 ---
    array<i32, 15>(2, 0, 7, 2, 7, 11, 0, 9, 7, 6, 7, 10, 9, 10, 7),
    // --- ENTRY 122 ---
    array<i32, 15>(1, 8, 0, 1, 7, 8, 1, 10, 7, 6, 7, 10, 2, 3, 11),
    // --- ENTRY 123 ---
    array<i32, 15>(11, 2, 1, 11, 1, 7, 10, 6, 1, 6, 7, 1, -1, -1, -1),
    // --- ENTRY 124 ---
    array<i32, 15>(8, 9, 6, 8, 6, 7, 9, 1, 6, 11, 6, 3, 1, 3, 6),
    // --- ENTRY 125 ---
    array<i32, 15>(0, 9, 1, 11, 6, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 126 ---
    array<i32, 15>(7, 8, 0, 7, 0, 6, 3, 11, 0, 11, 6, 0, -1, -1, -1),
    // --- ENTRY 127 ---
    array<i32, 15>(7, 11, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 128 ---
    array<i32, 15>(7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 129 ---
    array<i32, 15>(3, 0, 8, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 130 ---
    array<i32, 15>(0, 1, 9, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 131 ---
    array<i32, 15>(8, 1, 9, 8, 3, 1, 11, 7, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 132 ---
    array<i32, 15>(10, 1, 2, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 133 ---
    array<i32, 15>(1, 2, 10, 3, 0, 8, 6, 11, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 134 ---
    array<i32, 15>(2, 9, 0, 2, 10, 9, 6, 11, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 135 ---
    array<i32, 15>(6, 11, 7, 2, 10, 3, 10, 8, 3, 10, 9, 8, -1, -1, -1),
    // --- ENTRY 136 ---
    array<i32, 15>(7, 2, 3, 6, 2, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 137 ---
    array<i32, 15>(7, 0, 8, 7, 6, 0, 6, 2, 0, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 138 ---
    array<i32, 15>(2, 7, 6, 2, 3, 7, 0, 1, 9, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 139 ---
    array<i32, 15>(1, 6, 2, 1, 8, 6, 1, 9, 8, 8, 7, 6, -1, -1, -1),
    // --- ENTRY 140 ---
    array<i32, 15>(10, 7, 6, 10, 1, 7, 1, 3, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 141 ---
    array<i32, 15>(10, 7, 6, 1, 7, 10, 1, 8, 7, 1, 0, 8, -1, -1, -1),
    // --- ENTRY 142 ---
    array<i32, 15>(0, 3, 7, 0, 7, 10, 0, 10, 9, 6, 10, 7, -1, -1, -1),
    // --- ENTRY 143 ---
    array<i32, 15>(7, 6, 10, 7, 10, 8, 8, 10, 9, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 144 ---
    array<i32, 15>(6, 8, 4, 11, 8, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 145 ---
    array<i32, 15>(3, 6, 11, 3, 0, 6, 0, 4, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 146 ---
    array<i32, 15>(8, 6, 11, 8, 4, 6, 9, 0, 1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 147 ---
    array<i32, 15>(9, 4, 6, 9, 6, 3, 9, 3, 1, 11, 3, 6, -1, -1, -1),
    // --- ENTRY 148 ---
    array<i32, 15>(6, 8, 4, 6, 11, 8, 2, 10, 1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 149 ---
    array<i32, 15>(1, 2, 10, 3, 0, 11, 0, 6, 11, 0, 4, 6, -1, -1, -1),
    // --- ENTRY 150 ---
    array<i32, 15>(4, 11, 8, 4, 6, 11, 0, 2, 9, 2, 10, 9, -1, -1, -1),
    // --- ENTRY 151 ---
    array<i32, 15>(10, 9, 3, 10, 3, 2, 9, 4, 3, 11, 3, 6, 4, 6, 3),
    // --- ENTRY 152 ---
    array<i32, 15>(8, 2, 3, 8, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 153 ---
    array<i32, 15>(0, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 154 ---
    array<i32, 15>(1, 9, 0, 2, 3, 4, 2, 4, 6, 4, 3, 8, -1, -1, -1),
    // --- ENTRY 155 ---
    array<i32, 15>(1, 9, 4, 1, 4, 2, 2, 4, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 156 ---
    array<i32, 15>(8, 1, 3, 8, 6, 1, 8, 4, 6, 6, 10, 1, -1, -1, -1),
    // --- ENTRY 157 ---
    array<i32, 15>(10, 1, 0, 10, 0, 6, 6, 0, 4, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 158 ---
    array<i32, 15>(4, 6, 3, 4, 3, 8, 6, 10, 3, 0, 3, 9, 10, 9, 3),
    // --- ENTRY 159 ---
    array<i32, 15>(10, 9, 4, 6, 10, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 160 ---
    array<i32, 15>(4, 9, 5, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 161 ---
    array<i32, 15>(0, 8, 3, 4, 9, 5, 11, 7, 6, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 162 ---
    array<i32, 15>(5, 0, 1, 5, 4, 0, 7, 6, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 163 ---
    array<i32, 15>(11, 7, 6, 8, 3, 4, 3, 5, 4, 3, 1, 5, -1, -1, -1),
    // --- ENTRY 164 ---
    array<i32, 15>(9, 5, 4, 10, 1, 2, 7, 6, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 165 ---
    array<i32, 15>(6, 11, 7, 1, 2, 10, 0, 8, 3, 4, 9, 5, -1, -1, -1),
    // --- ENTRY 166 ---
    array<i32, 15>(7, 6, 11, 5, 4, 10, 4, 2, 10, 4, 0, 2, -1, -1, -1),
    // --- ENTRY 167 ---
    array<i32, 15>(3, 4, 8, 3, 5, 4, 3, 2, 5, 10, 5, 2, 11, 7, 6),
    // --- ENTRY 168 ---
    array<i32, 15>(7, 2, 3, 7, 6, 2, 5, 4, 9, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 169 ---
    array<i32, 15>(9, 5, 4, 0, 8, 6, 0, 6, 2, 6, 8, 7, -1, -1, -1),
    // --- ENTRY 170 ---
    array<i32, 15>(3, 6, 2, 3, 7, 6, 1, 5, 0, 5, 4, 0, -1, -1, -1),
    // --- ENTRY 171 ---
    array<i32, 15>(6, 2, 8, 6, 8, 7, 2, 1, 8, 4, 8, 5, 1, 5, 8),
    // --- ENTRY 172 ---
    array<i32, 15>(9, 5, 4, 10, 1, 6, 1, 7, 6, 1, 3, 7, -1, -1, -1),
    // --- ENTRY 173 ---
    array<i32, 15>(1, 6, 10, 1, 7, 6, 1, 0, 7, 8, 7, 0, 9, 5, 4),
    // --- ENTRY 174 ---
    array<i32, 15>(4, 0, 10, 4, 10, 5, 0, 3, 10, 6, 10, 7, 3, 7, 10),
    // --- ENTRY 175 ---
    array<i32, 15>(7, 6, 10, 7, 10, 8, 5, 4, 10, 4, 8, 10, -1, -1, -1),
    // --- ENTRY 176 ---
    array<i32, 15>(6, 9, 5, 6, 11, 9, 11, 8, 9, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 177 ---
    array<i32, 15>(3, 6, 11, 0, 6, 3, 0, 5, 6, 0, 9, 5, -1, -1, -1),
    // --- ENTRY 178 ---
    array<i32, 15>(0, 11, 8, 0, 5, 11, 0, 1, 5, 5, 6, 11, -1, -1, -1),
    // --- ENTRY 179 ---
    array<i32, 15>(6, 11, 3, 6, 3, 5, 5, 3, 1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 180 ---
    array<i32, 15>(1, 2, 10, 9, 5, 11, 9, 11, 8, 11, 5, 6, -1, -1, -1),
    // --- ENTRY 181 ---
    array<i32, 15>(0, 11, 3, 0, 6, 11, 0, 9, 6, 5, 6, 9, 1, 2, 10),
    // --- ENTRY 182 ---
    array<i32, 15>(11, 8, 5, 11, 5, 6, 8, 0, 5, 10, 5, 2, 0, 2, 5),
    // --- ENTRY 183 ---
    array<i32, 15>(6, 11, 3, 6, 3, 5, 2, 10, 3, 10, 5, 3, -1, -1, -1),
    // --- ENTRY 184 ---
    array<i32, 15>(5, 8, 9, 5, 2, 8, 5, 6, 2, 3, 8, 2, -1, -1, -1),
    // --- ENTRY 185 ---
    array<i32, 15>(9, 5, 6, 9, 6, 0, 0, 6, 2, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 186 ---
    array<i32, 15>(1, 5, 8, 1, 8, 0, 5, 6, 8, 3, 8, 2, 6, 2, 8),
    // --- ENTRY 187 ---
    array<i32, 15>(1, 5, 6, 2, 1, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 188 ---
    array<i32, 15>(1, 3, 6, 1, 6, 10, 3, 8, 6, 5, 6, 9, 8, 9, 6),
    // --- ENTRY 189 ---
    array<i32, 15>(10, 1, 0, 10, 0, 6, 9, 5, 0, 5, 6, 0, -1, -1, -1),
    // --- ENTRY 190 ---
    array<i32, 15>(0, 3, 8, 5, 6, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 191 ---
    array<i32, 15>(10, 5, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 192 ---
    array<i32, 15>(11, 5, 10, 7, 5, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 193 ---
    array<i32, 15>(11, 5, 10, 11, 7, 5, 8, 3, 0, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 194 ---
    array<i32, 15>(5, 11, 7, 5, 10, 11, 1, 9, 0, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 195 ---
    array<i32, 15>(10, 7, 5, 10, 11, 7, 9, 8, 1, 8, 3, 1, -1, -1, -1),
    // --- ENTRY 196 ---
    array<i32, 15>(11, 1, 2, 11, 7, 1, 7, 5, 1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 197 ---
    array<i32, 15>(0, 8, 3, 1, 2, 7, 1, 7, 5, 7, 2, 11, -1, -1, -1),
    // --- ENTRY 198 ---
    array<i32, 15>(9, 7, 5, 9, 2, 7, 9, 0, 2, 2, 11, 7, -1, -1, -1),
    // --- ENTRY 199 ---
    array<i32, 15>(7, 5, 2, 7, 2, 11, 5, 9, 2, 3, 2, 8, 9, 8, 2),
    // --- ENTRY 200 ---
    array<i32, 15>(2, 5, 10, 2, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 201 ---
    array<i32, 15>(8, 2, 0, 8, 5, 2, 8, 7, 5, 10, 2, 5, -1, -1, -1),
    // --- ENTRY 202 ---
    array<i32, 15>(9, 0, 1, 5, 10, 3, 5, 3, 7, 3, 10, 2, -1, -1, -1),
    // --- ENTRY 203 ---
    array<i32, 15>(9, 8, 2, 9, 2, 1, 8, 7, 2, 10, 2, 5, 7, 5, 2),
    // --- ENTRY 204 ---
    array<i32, 15>(1, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 205 ---
    array<i32, 15>(0, 8, 7, 0, 7, 1, 1, 7, 5, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 206 ---
    array<i32, 15>(9, 0, 3, 9, 3, 5, 5, 3, 7, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 207 ---
    array<i32, 15>(9, 8, 7, 5, 9, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 208 ---
    array<i32, 15>(5, 8, 4, 5, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 209 ---
    array<i32, 15>(5, 0, 4, 5, 11, 0, 5, 10, 11, 11, 3, 0, -1, -1, -1),
    // --- ENTRY 210 ---
    array<i32, 15>(0, 1, 9, 8, 4, 10, 8, 10, 11, 10, 4, 5, -1, -1, -1),
    // --- ENTRY 211 ---
    array<i32, 15>(10, 11, 4, 10, 4, 5, 11, 3, 4, 9, 4, 1, 3, 1, 4),
    // --- ENTRY 212 ---
    array<i32, 15>(2, 5, 1, 2, 8, 5, 2, 11, 8, 4, 5, 8, -1, -1, -1),
    // --- ENTRY 213 ---
    array<i32, 15>(0, 4, 11, 0, 11, 3, 4, 5, 11, 2, 11, 1, 5, 1, 11),
    // --- ENTRY 214 ---
    array<i32, 15>(0, 2, 5, 0, 5, 9, 2, 11, 5, 4, 5, 8, 11, 8, 5),
    // --- ENTRY 215 ---
    array<i32, 15>(9, 4, 5, 2, 11, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 216 ---
    array<i32, 15>(2, 5, 10, 3, 5, 2, 3, 4, 5, 3, 8, 4, -1, -1, -1),
    // --- ENTRY 217 ---
    array<i32, 15>(5, 10, 2, 5, 2, 4, 4, 2, 0, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 218 ---
    array<i32, 15>(3, 10, 2, 3, 5, 10, 3, 8, 5, 4, 5, 8, 0, 1, 9),
    // --- ENTRY 219 ---
    array<i32, 15>(5, 10, 2, 5, 2, 4, 1, 9, 2, 9, 4, 2, -1, -1, -1),
    // --- ENTRY 220 ---
    array<i32, 15>(8, 4, 5, 8, 5, 3, 3, 5, 1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 221 ---
    array<i32, 15>(0, 4, 5, 1, 0, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 222 ---
    array<i32, 15>(8, 4, 5, 8, 5, 3, 9, 0, 5, 0, 3, 5, -1, -1, -1),
    // --- ENTRY 223 ---
    array<i32, 15>(9, 4, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 224 ---
    array<i32, 15>(4, 11, 7, 4, 9, 11, 9, 10, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 225 ---
    array<i32, 15>(0, 8, 3, 4, 9, 7, 9, 11, 7, 9, 10, 11, -1, -1, -1),
    // --- ENTRY 226 ---
    array<i32, 15>(1, 10, 11, 1, 11, 4, 1, 4, 0, 7, 4, 11, -1, -1, -1),
    // --- ENTRY 227 ---
    array<i32, 15>(3, 1, 4, 3, 4, 8, 1, 10, 4, 7, 4, 11, 10, 11, 4),
    // --- ENTRY 228 ---
    array<i32, 15>(4, 11, 7, 9, 11, 4, 9, 2, 11, 9, 1, 2, -1, -1, -1),
    // --- ENTRY 229 ---
    array<i32, 15>(9, 7, 4, 9, 11, 7, 9, 1, 11, 2, 11, 1, 0, 8, 3),
    // --- ENTRY 230 ---
    array<i32, 15>(11, 7, 4, 11, 4, 2, 2, 4, 0, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 231 ---
    array<i32, 15>(11, 7, 4, 11, 4, 2, 8, 3, 4, 3, 2, 4, -1, -1, -1),
    // --- ENTRY 232 ---
    array<i32, 15>(2, 9, 10, 2, 7, 9, 2, 3, 7, 7, 4, 9, -1, -1, -1),
    // --- ENTRY 233 ---
    array<i32, 15>(9, 10, 7, 9, 7, 4, 10, 2, 7, 8, 7, 0, 2, 0, 7),
    // --- ENTRY 234 ---
    array<i32, 15>(3, 7, 10, 3, 10, 2, 7, 4, 10, 1, 10, 0, 4, 0, 10),
    // --- ENTRY 235 ---
    array<i32, 15>(1, 10, 2, 8, 7, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 236 ---
    array<i32, 15>(4, 9, 1, 4, 1, 7, 7, 1, 3, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 237 ---
    array<i32, 15>(4, 9, 1, 4, 1, 7, 0, 8, 1, 8, 7, 1, -1, -1, -1),
    // --- ENTRY 238 ---
    array<i32, 15>(4, 0, 3, 7, 4, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 239 ---
    array<i32, 15>(4, 8, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 240 ---
    array<i32, 15>(9, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 241 ---
    array<i32, 15>(3, 0, 9, 3, 9, 11, 11, 9, 10, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 242 ---
    array<i32, 15>(0, 1, 10, 0, 10, 8, 8, 10, 11, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 243 ---
    array<i32, 15>(3, 1, 10, 11, 3, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 244 ---
    array<i32, 15>(1, 2, 11, 1, 11, 9, 9, 11, 8, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 245 ---
    array<i32, 15>(3, 0, 9, 3, 9, 11, 1, 2, 9, 2, 11, 9, -1, -1, -1),
    // --- ENTRY 246 ---
    array<i32, 15>(0, 2, 11, 8, 0, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 247 ---
    array<i32, 15>(3, 2, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 248 ---
    array<i32, 15>(2, 3, 8, 2, 8, 10, 10, 8, 9, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 249 ---
    array<i32, 15>(9, 10, 2, 0, 9, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 250 ---
    array<i32, 15>(2, 3, 8, 2, 8, 10, 0, 1, 8, 1, 10, 8, -1, -1, -1),
    // --- ENTRY 251 ---
    array<i32, 15>(1, 10, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 252 ---
    array<i32, 15>(1, 3, 8, 9, 1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 253 ---
    array<i32, 15>(0, 9, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 254 ---
    array<i32, 15>(0, 3, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
    // --- ENTRY 255 ---
    array<i32, 15>(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1),
);

// ============================================================================
// Count how many triangles for a cube index
// ============================================================================
fn mc_triangle_count(cube : u32) -> u32 {
    var c : u32 = 0u;
    let row = TRIANGULATIONS[cube];

    // Each 3 entries form a triangle. Stop at -1 sentinel.
    for (var i : u32 = 0u; i < 15u; i = i + 3u) {
        if (row[i] == -1) {
            break;
        }
        c = c + 1u;
    }
    return c;
}

// ============================================================================
// Look up the i'th triangle for a cube index
// Returns the 3 edge indices for that triangle
// ============================================================================
fn mc_get_triangle_edges(cube : u32, tri : u32) -> vec3<i32> {
    let base = tri * 3u;
    let row = TRIANGULATIONS[cube];
    return vec3<i32>(row[base], row[base + 1u], row[base + 2u]);
}
